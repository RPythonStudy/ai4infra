services:
  postgres:
    image: postgres:16.3-alpine
    container_name: ai4infra-postgres
    restart: unless-stopped

    mem_limit: 640m

    ports:
      - "${PORT:-5432}:5432"
    networks:
      - ai4infra

    environment:
      - POSTGRES_USER=${POSTGRES_USER:-postgres}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD:-ai4infra123!}
      - POSTGRES_DB=${POSTGRES_DB:-ai4infra}

    volumes:
      - ${DATA_DIR:-/opt/ai4infra/postgres/data}:/var/lib/postgresql/data

    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 2s
      timeout: 2s
      retries: 10

networks:
  ai4infra:
    external: true
    name: ai4infra


