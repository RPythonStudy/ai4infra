version: "3.9"

services:
  postgres:
    command:
      - "postgres"
      - "-c"
      - "ssl=on"
      - "-c"
      - "ssl_cert_file=/var/lib/postgresql/data/server.crt"
      - "-c"
      - "ssl_key_file=/var/lib/postgresql/data/server.key"
      - "-c"
      - "ssl_ca_file=/var/lib/postgresql/data/rootCA.crt"

    volumes:
      # PostgreSQL 데이터 디렉터리
      - /opt/ai4infra/postgres/data:/var/lib/postgresql/data

      # TLS 인증서 3종을 PostgreSQL이 찾는 정확한 경로로 마운트
      - /opt/ai4infra/postgres/certs/certificate.crt:/var/lib/postgresql/data/server.crt:ro
      - /opt/ai4infra/postgres/certs/private.key:/var/lib/postgresql/data/server.key:ro
      - /opt/ai4infra/postgres/certs/rootCA.crt:/var/lib/postgresql/data/rootCA.crt:ro

    # (선택) UID/GID 80:80 강제 설정이 필요하면 다음을 추가
    # user: "80:80"
