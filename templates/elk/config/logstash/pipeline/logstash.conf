input {
  beats {
    port => 5044
  }
}

filter {
  # Python 로거 등에서 보낸 JSON 형태의 로그라면 파싱
  # Filebeat가 이미 json 포맷으로 보내면 중복일 수 있으나, 안전장치로 둠
  if [message] =~ /^{.*}$/ {
    json {
      source => "message"
    }
  }
}

output {
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    # 인덱스명 패턴: ai4infra-YYYY.MM.DD
    index => "ai4infra-%{+YYYY.MM.dd}"
  }
  # 디버깅용: 컨테이너 로그로 출력 (운영 시 주석 처리 가능)
  # 디버깅용: 컨테이너 로그로 출력 (운영 시 주석 처리 권장)
  # stdout { codec => rubydebug }
}
