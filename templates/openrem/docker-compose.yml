services:
  openrem:
    image: openrem/openrem:${OPENREM_VERSION:-1.0.0b2}
    container_name: ai4infra-openrem
    ports:
      - "${OPENREM_PORT:-8086}:8000"
    environment:
      - DATABASE_URL=postgres://${OPENREM_DB_USER}:${OPENREM_DB_PASSWORD}@${OPENREM_DB_HOST}:${OPENREM_DB_PORT}/${OPENREM_DB_NAME}
      - CELERY_BROKER_URL=redis://${REDIS_HOST}:6379/0
      - DJANGO_SECRET_KEY=${OPENREM_SECRET_KEY}
      - ALLOWED_HOSTS=${ALLOWED_HOSTS}
      - DJANGO_SETTINGS_MODULE=openrem.settings.docker
    volumes:
      - ./static:/app/static
      - ./media:/app/media
    restart: unless-stopped
    networks:
      - ai4infra
    depends_on:
      - openrem-worker

  openrem-worker:
    image: openrem/openrem:${OPENREM_VERSION:-1.0.0b2}
    container_name: ai4infra-openrem-worker
    command: celery -A openrem worker --loglevel=info
    environment:
      - DATABASE_URL=postgres://${OPENREM_DB_USER}:${OPENREM_DB_PASSWORD}@${OPENREM_DB_HOST}:${OPENREM_DB_PORT}/${OPENREM_DB_NAME}
      - CELERY_BROKER_URL=redis://${REDIS_HOST}:6379/0
      - DJANGO_SECRET_KEY=${OPENREM_SECRET_KEY}
      - DJANGO_SETTINGS_MODULE=openrem.settings.docker
    volumes:
      - ./media:/app/media
    restart: unless-stopped
    networks:
      - ai4infra

networks:
  ai4infra:
    external: true
    name: ai4infra
